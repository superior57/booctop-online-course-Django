 {% load static %}
<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Teacher - dashboard</title>
    {% load static %}
    <!-- Prevent the demo from appearing in search engines -->
    <meta name="robots" content="noindex">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CRoboto:400,500%7CExo+2:600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">

    <!-- Perfect Scrollbar -->
    <link type="text/css" href="{%static 'teacher/assets/vendor/perfect-scrollbar.css' %}" rel="stylesheet">

    <!-- Fix Footer CSS -->
    <link type="text/css" href="{%static 'teacher/assets/vendor/fix-footer.css' %}" rel="stylesheet">

    <!-- Material Design Icons -->
    <link type="text/css" href="{%static 'teacher/assets/css/material-icons.css' %}" rel="stylesheet">


    <!-- Font Awesome Icons -->
    <link type="text/css" href="{%static 'teacher/assets/css/fontawesome.css' %}" rel="stylesheet">


    <!-- Preloader -->
    <link type="text/css" href="{%static 'teacher/assets/css/preloader.css' %}" rel="stylesheet">


    <!-- App CSS -->
    <link type="text/css" href="{%static 'teacher/assets/css/app.css' %}" rel="stylesheet">



    <!-- Flatpickr -->
    <link type="text/css" href="{%static 'teacher/assets/css/flatpickr.css' %}" rel="stylesheet">

    <link type="text/css" href="{%static 'teacher/assets/css/flatpickr-airbnb.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{%static 'teacher/assets/css/style.css' %}" rel="stylesheet"> {% block head %} {% endblock %}

    <!-- <link rel="stylesheet" href="{% static 'assets/css/dark.css' %}"> -->



</head>



<body class="layout-mini layout-mini">

    <input type="hidden" id="hd_csrf" value="{{ csrf_token }}">
    <div class="preloader">
        <div class="sk-double-bounce">
            <div class="sk-child sk-double-bounce1"></div>
            <div class="sk-child sk-double-bounce2"></div>
        </div>
    </div>

    <div class="mdk-drawer-layout js-mdk-drawer-layout" data-push data-responsive-width="992px">
        <div class="mdk-drawer-layout__content page-content">

        {% block headercontent %}
        {% endblock %}

        {% block content %} 
        {% endblock %}

        </div>
        <!-- // END drawer-layout__content -->

        {% block modal %}
        {% endblock %}

        {% include './layout/left-sidebar.html' %}
        

    </div>
    <!-- // END drawer-layout -->

    <div class="chatbot chatbot--closed">
        <div class="chatbot__header">
            <p><strong style="color: white;">Do you need any help?</strong></p>
            <svg class="chatbot__close-button icon-speech" viewBox="0 0 32 32">
                <use xlink:href="#icon-speech" />
            </svg>
            <svg class="chatbot__close-button icon-close" viewBox="0 0 32 32">
                <use xlink:href="#icon-close" />
            </svg>
        </div>
        <div class="chatbot__message-window">
            <ul class="chatbot__messages">
                <li class="is-ai animation">
                    <div class="is-ai__profile-picture">
                        <img src="{%static 'assets/img/favicon.png' %}" alt="">
                    </div>
                    <span class="chatbot__arrow chatbot__arrow--left"></span>
                    <p class='chatbot__message'>Hello there ðŸ™Œ, How we can help you?

                    </p>

                </li>
                <!-- Message here -->
            </ul>
        </div>
        <div class="chatbot__entry chatbot--closed">
            <input type="text" class="chatbot__input" placeholder="Write a message..." />
            <svg class="chatbot__submit" viewBox="0 0 32 32">
                <use xlink:href="#icon-send" />
            </svg>
        </div>
    </div>

    <!-- Symbols -->
    <svg>
        <!-- Close icon -->
        <symbol id="icon-close" viewBox="0 0 32 32">
            <title>Close</title>
            <path d="M2.624 8.297l2.963-2.963 23.704 23.704-2.963 2.963-23.704-23.704z" />
            <path d="M2.624 29.037l23.704-23.704 2.963 2.963-23.704 23.704-2.963-2.963z" />
        </symbol>
    
        <!-- Speech icon -->
        <symbol id="icon-speech" viewBox="0 0 32 32">
            <title>Speech</title>
            <path d="M21.795 5.333h-11.413c-0.038 0-0.077 0-0.114 0l-0.134 0.011v2.796c0.143-0.006 0.273-0.009 0.385-0.009h11.277c0.070 0 7.074 0.213 7.074 7.695 0 5.179-2.956 7.695-9.036 7.695h-3.792c-0.691 0-1.12 0.526-1.38 1.159l-1.387 3.093-1.625 3.77 0.245 0.453h2.56l2.538-5.678h2.837c7.633 0 11.84-3.727 11.84-10.494 0.001-8.564-7.313-10.492-9.875-10.492z" />
            <path d="M10.912 24.259c-0.242-0.442-0.703-0.737-1.234-0.737-0 0-0 0-0 0h-0.56c-0.599-0.011-1.171-0.108-1.71-0.28l0.042 0.012c-1.82-0.559-4.427-2.26-4.427-7.424 0-6.683 5.024-7.597 7.109-7.686v-2.8c-2.042 0.095-9.91 1.067-9.91 10.483 0 4.832 1.961 7.367 3.606 8.64 1.38 1.067 3.109 1.744 4.991 1.843l0.033 0.019 2.805 5.211 1.41-3.273z" />
        </symbol>
    
        <!-- Send icon -->
        <symbol id="icon-send" viewBox="0 0 23.97 21.9">
            <title>Send</title>
            <path d="M0.31,9.43a0.5,0.5,0,0,0,0,.93l8.3,3.23L23.15,0Z"/>
            <path d="M9,14.6H9V21.4a0.5,0.5,0,0,0,.93.25L13.22,16l6,3.32A0.5,0.5,0,0,0,20,19l4-18.4Z"/>
        </symbol>
    
        <!-- Avatar icon -->
        <symbol id="avatar" width="44.25" height="44" viewBox="0 0 44.25 44">
            <title>Avatar</title>
            <path style="fill: #7226e0; fill-rule: evenodd;" d="M1035.88,1696.25a22,22,0,1,1-22.13,22A22.065,22.065,0,0,1,1035.88,1696.25Z" transform="translate(-1013.75 -1696.25)"/>
            <path style="fill: #fff; fill-rule: evenodd;" d="M1030.18,1725.16h2.35a0.335,0.335,0,0,0,.34-0.33v-5.23h5.94v5.23a0.342,0.342,0,0,0,.34.33h2.36a0.342,0.342,0,0,0,.34-0.33v-12.36a0.34,0.34,0,0,0-.34-0.32h-2.36a0.34,0.34,0,0,0-.34.32v4.51h-5.94v-4.51a0.333,0.333,0,0,0-.34-0.32h-2.35a0.333,0.333,0,0,0-.34.32v12.36a0.335,0.335,0,0,0,.34.33" transform="translate(-1013.75 -1696.25)"/>
        </symbol>
    
    </svg>

    <!-- Axios -->
    <script src="{% static 'assets/js/axios.min.js' %}"></script>

    <!-- jQuery -->
    <script src="{%static 'teacher/assets/vendor/jquery.min.js' %}"></script>

    <!-- Bootstrap -->
    <script src="{%static 'teacher/assets/vendor/popper.min.js' %}"></script>
    <script src="{%static 'teacher/assets/vendor/bootstrap.min.js' %}"></script>

    <!-- Perfect Scrollbar -->
    <script src="{%static 'teacher/assets/vendor/perfect-scrollbar.min.js' %}"></script>

    <!-- DOM Factory -->
    <script src="{%static 'teacher/assets/vendor/dom-factory.js' %}"></script>

    <!-- MDK -->
    <script src="{%static 'teacher/assets/vendor/material-design-kit.js' %}"></script>

    <!-- Fix Footer -->
    <script src="{%static 'teacher/assets/vendor/fix-footer.js' %}"></script>

    <!-- App JS -->
    <script src="{%static 'teacher/assets/js/app.js' %}"></script>






    <!-- Global Settings -->
    <script src="{%static 'teacher/assets/js/settings.js' %}"></script>

    <!-- Moment.js -->
    <script src="{%static 'teacher/assets/vendor/moment.min.js' %}"></script>
    <script src="{%static 'teacher/assets/vendor/moment-range.min.js' %}"></script>

    <!-- Flatpickr -->
    <script src="{%static 'teacher/assets/vendor/flatpickr/flatpickr.min.js' %}"></script>
    <script src="{%static 'teacher/assets/js/flatpickr.js' %}"></script>

    

    <!-- List.js -->
    <script src="{%static 'teacher/assets/vendor/list.min.js' %}"></script>
    <script src="{%static 'teacher/assets/js/list.js' %}"></script>

    <!-- Tables -->
    <script src="{%static 'teacher/assets/js/toggle-check-all.js' %}"></script>
    <script src="{%static 'teacher/assets/js/check-selected-row.js' %}"></script>

    <!-- Sidebar Mini JS -->
    <script src="{%static 'teacher/assets/js/sidebar-mini.js' %}"></script>
    {% block script %} {% endblock %}

    <script>
        (function() {
            'use strict';

            // ENABLE sidebar menu tabs
            $('.js-sidebar-mini-tabs [data-toggle="tab"]').on('click', function(e) {
                e.preventDefault()
                $(this).tab('show')
            })

            $('.js-sidebar-mini-tabs').on('show.bs.tab', function(e) {
                $('.js-sidebar-mini-tabs > .active').removeClass('active')
                $(e.target).parent().addClass('active')
            })
        })()
    </script>
    <script>
        $.ajaxSetup({
            headers: {
                'X-CSRFToken': $("#hd_csrf").val(),
            }
        });
        let config = {
            headers: {'X-CSRFToken': $("#hd_csrf").val()},
        };
    </script>
    <script>
    var Botkit = require('botkit');

    var controller = new Botkit({});


    controller.hears('hello', 'message', async(bot, message) => {

        await bot.reply(message, 'Howdy!');

    });
    // Tell the bot to listen for users saying "hello," and use `bot.reply` to send an immediate response.


    const tacos = new BotkitConversation('tacos', controller);
    tacos.say('Oh boy, taco time!');
    tacos.ask('What type of taco do you want?', async(answer, convo, bot) => {

        // do something with the answer!

    }, 'type_of_taco');
    tacos.say('Yum!!');
    controller.addDialog(tacos);

    controller.hears('tacos', 'message', async(bot, message) => {
        await bot.beginDialog('tacos');
    });
</script>
<script>
    const accessToken = "2af13bcd195349aba75a1c003d0dd75b";
        const baseUrl = "https://api.api.ai/api/query?v=20150910";
        const sessionId = "1234567890";
        const loadingMarkups = "<span class='loader'><span class='loader__dot'></span><span class='loader__dot'></span><span class='loader__dot'></span></span>";
        const errorMessage = "Stay around while we repling..";
        const urlPattern = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
        const loadingDelay = 700;
        const aiReplyDelay = 1800;
        const $document = document;
        const $chatbot = $document.querySelector(".chatbot");
        const $chatbotMessageWindow = $document.querySelector(".chatbot__message-window");
        const $chatbotHeader = $document.querySelector(".chatbot__header");
        const $chatbotMessages = $document.querySelector(".chatbot__messages");
        const $chatbotInput = $document.querySelector(".chatbot__input");
        const $chatbotSubmit = $document.querySelector(".chatbot__submit");

        $chatbotHeader.addEventListener("click", () => {
            toggle($chatbot, "chatbot--closed");
            $chatbotInput.focus();
        }, false);

        document.addEventListener("keypress", event => {
            if (event.which === 13) {
                validateMessage();
            }
        }, false);

        $chatbotSubmit.addEventListener("click", () => {
            validateMessage();
        }, false);

        let toggle = (element, klass) => {
            let classes = element.className.match(/\S+/g) || [],
                index = classes.indexOf(klass);
            if (index >= 0) {
                classes.splice(index, 1);
            } else {
                classes.push(klass);
            }
            element.className = classes.join(" ");
        };

        let userMessage = content => {
            $chatbotMessages.innerHTML += `
          <li class='is-user animation'>          

        <p class='chatbot__message'>
          ${content}
        </p>
        <span class='chatbot__arrow chatbot__arrow--right'></span>          
        <img src="./../static{{user.image}}" style="border:2px solid grey;margin-left:5px;width:40px;float:right;height:40px;border-radius:50%" />

      </li>`;
        };

        let aiMessage = (content, isLoading = false, delay = 0) => {
            setTimeout(() => {
                removeLoader();
                $chatbotMessages.innerHTML += `<li 
            class='is-ai animation' 
            id='${isLoading ? "is-loading" : ""}'>
              <div class="is-ai__profile-picture">
                 <img src="../../assets/img/favicon.png' %}" alt="">
              </div>
              <span class='chatbot__arrow chatbot__arrow--left'></span>
              <div class='chatbot__message'>
                ${content}                 
                <small style="position:absolute;right:40px;bottom:5px;color: grey;"><b>now</b></small>

              </div>
            </li>
   
            `;
                scrollDown();
            }, delay);
        };

        let removeLoader = () => {
            let loadingElem = document.getElementById("is-loading");
            if (loadingElem) {
                $chatbotMessages.removeChild(loadingElem);
            }
        };

        let escapeScript = unsafe => {
            let safeString = unsafe.replace(/</g, " ")
                .replace(/>/g, " ")
                .replace(/&/g, " ")
                .replace(/"/g, " ")
                .replace(/\\/, " ")
                .replace(/\s+/g, " ");
            return safeString.trim();
        };

        let linkify = inputText => {
            return inputText.replace(urlPattern, '<a href="$1" target="_blank">$1</a>');
        };

        let validateMessage = () => {
            let text = $chatbotInput.value;
            let safeText = text ? escapeScript(text) : "";
            if (safeText.length && safeText !== " ") {
                resetInputField();
                userMessage(safeText);
                send(safeText);
            }
            scrollDown();
            return;
        };

        let multiChoiceAnswer = text => {
            let decodedText = text.replace(/zzz/g, "'");
            userMessage(decodedText);
            send(decodedText);
            scrollDown();
            return;
        };

        let processResponse = val => {
            removeLoader();
            if (val.fulfillment) {
                let output = "";
                let messagesLength = val.fulfillment.messages.length;
                for (let i = 0; i < messagesLength; i++) {
                    let message = val.fulfillment.messages[i];
                    let type = message.type;
                    switch (type) {
                        // 0 fulfillment is text
                        case 0:
                            let parsedText = linkify(message.speech);
                            output += `<p>${parsedText}</p>`;
                            break;
                            // 1 fulfillment is card
                        case 1:
                            // let imageUrl = message.imageUrl
                            // let imageTitle = message.title
                            // let imageSubtitle = message.subtitle
                            // output += `<img src="${imageUrl}" alt="${imageTitle}${imageSubtitle}" />`
                            break;
                            // 2 fulfillment is button list
                        case 2:
                            let title = message.title;
                            let replies = message.replies;
                            let repliesLength = replies.length;
                            output += `<p>${title}</p>`;
                            for (let i = 0; i < repliesLength; i++) {
                                let reply = replies[i];
                                let encodedText = reply.replace(/'/g, "zzz");
                                output += `<button onclick='multiChoiceAnswer("${encodedText}")'>${reply}</button>`;
                            }
                            break;
                            // 3 fulfillment is image
                        case 3:
                            // console.log("Fulfillment is image - TODO")
                            break;
                    }
                }
                return output;
            } else {
                return val;
            }
        };

        let setResponse = (val, delay = 0) => {
            setTimeout(() => {
                aiMessage(processResponse(val));
            }, delay);
        };

        let resetInputField = () => {
            $chatbotInput.value = "";
        };

        let scrollDown = () => {
            let distanceToScroll = $chatbotMessageWindow.scrollHeight - ($chatbotMessages.lastChild.offsetHeight + 60);
            $chatbotMessageWindow.scrollTop = distanceToScroll;
            return false;
        };

        let send = (text) => {
            fetch(`${baseUrl}&query=${text}&lang=en&sessionId=${sessionId}`, {
                    method: "GET",
                    dataType: "json",
                    headers: {
                        Authorization: "Bearer " + accessToken,
                        "Content-Type": "application/json; charset=utf-8"
                    }
                })
                .then(response => response.json())
                .then(res => {
                    if (res.status < 200 || res.status >= 300) {
                        let error = new Error(res.statusText);
                        throw error;
                    }
                    return res;
                }).then(res => {
                    // console.log(JSON.stringify(response.result, undefined, 2))
                    setResponse(res.result, loadingDelay + aiReplyDelay);
                }).catch(error => {
                    setResponse(errorMessage, loadingDelay + aiReplyDelay);
                    resetInputField();
                    //console.log( error );
                });
            aiMessage(loadingMarkups, true, loadingDelay);
        };
</script>

<script>
    $(document).ready(function() {
        var color = localStorage.getItem('mode');
        console.log(color);
        color_mode();
    });

    let head = document.getElementsByTagName('HEAD')[0];

        // Create new link Element 
    let link = document.createElement('link');

    // set the attributes for link element  
    link.rel = 'stylesheet';

    link.type = 'text/css';

    link.href = "{%static 'teacher/assets/css/dark.css' %}";

    function color_mode()
        {
            if (localStorage.getItem('mode') == 'dark') {
                head.appendChild(link);

            } else {                
                head.removeChild(link);
            }
        }
</script>


</body>

</html>